"use strict";function parseDate(a){return new Date(a)}var app=angular.module("TotalRecall",["ngAnimate","ngCookies","ngMessages","ngResource","ui.router","ngSanitize","ngTouch","ngMaterial","angularUtils.directives.dirPagination","ngMap","angular-jqcloud","materialDatePicker"]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("search",{url:"/search",templateUrl:"views/search.html"}).state("results",{"abstract":!0,params:{query:null},controller:"ResultsCtrl",templateUrl:"views/results.html"}).state("results.list",{url:"/results",params:{query:null},controller:"ResultsCtrl",parent:"results",templateUrl:"views/results.list.html"}).state("results.wordCloud",{url:"/results",params:{query:null},controller:"WordcloudCtrl",parent:"results",templateUrl:"views/results.wordCloud.html"}).state("results.analytics",{url:"/resultsanalytics",params:{query:null},controller:"ResultsCtrl",parent:"results",templateUrl:"views/results.analytics.html"}),b.otherwise("/results")}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]).config(["$mdIconProvider",function(a){a.iconSet("social","img/icons/sets/social-icons.svg",24).defaultIconSet("img/icons/sets/core-icons.svg",24)}]).config(["paginationTemplateProvider",function(a){a.setPath("views/template.paginate.html")}]);angular.module("TotalRecall").factory("searchFactory",["$http","$q","apiUrl",function(a,b,c){return{searchQuery:function(d,e){var f=b.defer();return a({method:"GET",url:c+"search?q="+d+"&row="+e}).success(function(a){f.resolve(a)}).error(function(){f.reject("There is an error")}),f.promise},getTrending:function(){var d=b.defer();return a({method:"GET",url:c+"trendingTopics"}).success(function(a){d.resolve(a)}).error(function(){d.reject("There is an error")}),d.promise},getCloud:function(){var d=b.defer();return a({method:"GET",url:c+"trendingCloud"}).success(function(a){d.resolve(a)}).error(function(){d.reject("There is an error")}),d.promise}}}]),angular.module("TotalRecall").constant("apiUrl","https://totalrecallbackend.herokuapp.com/"),angular.module("TotalRecall").controller("SearchCtrl",["$scope","$state","searchFactory",function(a,b,c){var d=this;d.search=function(a){b.go("results.list",{query:a})}}]),Date.prototype.yyyymmdd=function(){var a=this.getFullYear().toString(),b=(this.getMonth()+1).toString(),c=this.getDate().toString();return a+"-"+(b[1]?b:"0"+b[0])+"-"+(c[1]?c:"0"+c[0])},app.controller("ResultsCtrl",["$scope","$state","$stateParams","searchFactory","NgMap",function(a,b,c,d,e){a.arrows={year:{left:"images/white_arrow_left.svg",right:"images/white_arrow_right.svg"},month:{left:"images/grey_arrow_left.svg",right:"images/grey_arrow_right.svg"}};var f=new Date;return a.Model=a.Model||{dynMarkers:[],locations:[],tweets:[],selectedIndex:0,myDate1:new Date(f.getFullYear(),f.getMonth()-1,1).yyyymmdd(),myDate2:f.yyyymmdd()},void 0==c.query&&void 0==a.Model.query?void b.go("search"):(a.selectedsentiment="all",c.query&&(a.Model.query=a.Model.query||c.query),a.search=function(b){b&&"#"==b[0]&&(b=b.substring(1)),a.Model.query=b,d.searchQuery(b,1).then(function(b){a.Model.tweets=[],a.Model.dynMarkers=[],a.Model.locations=[],b.locations.map(function(a){return JSON.parse(JSON.stringify(a))}),void 0!==a.Model.markerClusterer&&a.Model.markerClusterer.setMap(null),a.Model.tweets=b.tweets,a.Model.locations=b.locations,a.Model.facet=b.facet_fields||null,console.log(b.facet_fields),e.getMap().then(function(c){for(var d=0;d<b.locations.length;d++){var e=new google.maps.LatLng(a.Model.locations[d][0],a.Model.locations[d][1]),f=new google.maps.Marker({position:e});f.setVisible(!1),a.Model.dynMarkers.push(f)}a.Model.markerClusterer=new MarkerClusterer(c,a.Model.dynMarkers,{})})})},a.search(a.Model.query),void d.getTrending().then(function(b){a.trending=b.trending}))}]),angular.module("TotalRecall").filter("sentiment",function(){return function(a,b){return"all"==b?a:a?a.filter(function(a,c){return a.sentiment.toLowerCase()==b}):void 0}}),angular.module("TotalRecall").controller("WordcloudCtrl",["$scope","searchFactory",function(a,b){b.getCloud().then(function(b){a.trendingcloud=b.trending})}]),angular.module("TotalRecall").filter("datefilter",function(){return function(a,b,c){for(var d=parseDate(b),e=parseDate(c),f=[],g=0;g<a.length;g++){var h=new Date(a[g].date);h.getTime()>d.getTime()&&h.getTime()<e.getTime()&&f.push(a[g])}return f}});